// SCSS Mixins for FNX Components
@use "sass:map";
@use "sass:list";
@use 'variables' as *;

// Theme mixin - generates CSS custom properties for a theme
@mixin theme-colors($theme-name) {
  $theme-map: map.get($theme-colors, $theme-name);
  
  @each $key, $value in $theme-map {
    --fnx-#{$key}: #{$value};
  }
  
  // Add shadows based on theme
  @if $theme-name == 'dark' {
    @each $key, $value in $dark-shadows {
      --fnx-shadow-#{$key}: #{$value};
    }
  } @else {
    @each $key, $value in $shadows {
      --fnx-shadow-#{$key}: #{$value};
    }
  }
}

// Responsive breakpoint mixin
@mixin breakpoint($size) {
  $breakpoint: map.get($breakpoints, $size);
  
  @if $breakpoint {
    @media (min-width: $breakpoint) {
      @content;
    }
  } @else {
    @warn "Breakpoint '#{$size}' not found in $breakpoints map.";
  }
}

// Component size mixin
@mixin component-size($size) {
  $size-map: map.get($component-sizes, $size);
  
  @if $size-map {
    min-height: map.get($size-map, height);
    padding: map.get($size-map, padding);
    font-size: map.get($size-map, font-size);
  } @else {
    @warn "Component size '#{$size}' not found in $component-sizes map.";
  }
}

// Focus ring mixin
@mixin focus-ring($offset: 2px) {
  outline: 2px solid var(--fnx-focus-ring);
  outline-offset: $offset;
}

// Transition mixin
@mixin fnx-transition($properties...) {
  @if list.length($properties) == 0 {
    $properties: all;
  }
  transition: #{$properties} $transition-duration $transition-timing;
}

// Button reset mixin
@mixin button-reset {
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  font: inherit;
  color: inherit;
  text-decoration: none;
  outline: none;
}

// Visually hidden mixin (for accessibility)
@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Flex center mixin
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

// Absolute center mixin
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

// Truncate text mixin
@mixin truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// Form field base styles mixin
@mixin form-field-base {
  width: 100%;
  font-family: inherit;
  line-height: 1.5;
  color: var(--fnx-text-primary);
  background-color: var(--fnx-surface);
  border: 1px solid var(--fnx-border-normal);
  border-radius: map.get($border-radius, md);
  outline: none;
  @include fnx-transition(border-color, box-shadow, background-color);
  
  &::placeholder {
    color: var(--fnx-text-muted);
    opacity: 1;
  }
  
  &:hover:not(:disabled) {
    border-color: var(--fnx-border-strong);
    background-color: var(--fnx-surface-hover);
  }
  
  &:focus {
    border-color: var(--fnx-primary-500);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    background-color: var(--fnx-surface);
  }
  
  &:disabled {
    background-color: var(--fnx-surface-active);
    color: var(--fnx-text-muted);
    cursor: not-allowed;
    opacity: 0.6;
    
    &::placeholder {
      color: var(--fnx-text-muted);
    }
  }
}

// Form field states mixin
@mixin form-field-states {
  &--error {
    border-color: var(--fnx-error-500);
    
    &:focus {
      border-color: var(--fnx-error-500);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }
  }
  
  &--success {
    border-color: var(--fnx-success-500);
    
    &:focus {
      border-color: var(--fnx-success-500);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }
  }
  
  &--loading {
    position: relative;
  }
}

// Dark theme focus adjustments mixin
@mixin dark-theme-focus {
  :root[data-theme="dark"] &,
  .dark & {
    &:focus {
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
    }
    
    &--error:focus {
      box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.2);
    }
    
    &--success:focus {
      box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.2);
    }
  }
}

// Spinner animation mixin
@mixin spinner($size: 16px) {
  display: inline-block;
  width: $size;
  height: $size;
  border: 2px solid var(--fnx-border-normal);
  border-radius: 50%;
  border-top-color: var(--fnx-primary-500);
  animation: fnx-spin 1s ease-in-out infinite;
}

// Generate utility classes mixin
@mixin generate-spacing-utilities($prefix, $properties...) {
  @each $key, $value in $spacing {
    .#{$prefix}-#{$key} {
      @each $property in $properties {
        #{$property}: $value;
      }
    }
  }
}

// Scrollbar styling mixin
@mixin custom-scrollbar($width: 6px) {
  &::-webkit-scrollbar {
    width: $width;
  }
  
  &::-webkit-scrollbar-track {
    background: var(--fnx-surface-hover);
    border-radius: calc($width / 2);
  }
  
  &::-webkit-scrollbar-thumb {
    background: var(--fnx-border-strong);
    border-radius: calc($width / 2);
    
    &:hover {
      background: var(--fnx-text-secondary);
    }
  }
}

// Icon size mixin
@mixin icon-size($size) {
  width: $size;
  height: $size;
  flex-shrink: 0;
}

// Clear button mixin
@mixin clear-button {
  @include button-reset;
  @include flex-center;
  position: absolute;
  right: map.get($spacing, md);
  top: 50%;
  transform: translateY(-50%);
  color: var(--fnx-text-secondary);
  padding: map.get($spacing, xs);
  border-radius: map.get($border-radius, sm);
  pointer-events: auto;
  z-index: 2;
  @include fnx-transition(color);
  
  &:hover {
    color: var(--fnx-text-primary);
  }
  
  &:focus {
    @include focus-ring;
  }
  
  svg {
    @include icon-size(16px);
  }
}
